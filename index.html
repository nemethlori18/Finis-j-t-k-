<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>≈∞rhaj√≥s J√°t√©k</title>
  <style>
    body {
      text-align: center;
      font-family: Arial, sans-serif;
      overflow: hidden;
      margin: 0;
    }
    canvas {
      background-color: gray;
      display: block;
      margin: auto;
      border: 2px solid black;
    }
    .touch-zone {
      position: fixed;
      top: 0;
      width: 50%;
      height: 100%;
      background-color: rgba(255, 255, 0, 0);
      z-index: 5;
    }
    .touch-left { left: 0; }
    .touch-right { right: 0; }
    #game-over {
      display: none;
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      font-size: 24px;
      border-radius: 10px;
      z-index: 20;
    }
    #restart-button, #reset-leaderboard-button {
      margin-top: 10px;
      padding: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    #name-input-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    #name-input-screen input, #name-input-screen select {
      padding: 10px;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #name-input-screen button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
    #leaderboard {
      margin-top: 20px;
      color: white;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 10px;
    }
    #leaderboard h3 {
      margin: 5px;
    }
    #leaderboard ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #active-powerups {
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      font-size: 22px;
      z-index: 15;
    }
  </style>
</head>
<body>

<div id="name-input-screen">
  <h2>√çrd be a neved:</h2>
  <input type="text" id="playerNameInput" placeholder="N√©v">
  <select id="controlMode">
    <option value="touch">√ârint√©ses ir√°ny√≠t√°s</option>
    <option value="tilt">D√∂nthet≈ë ir√°ny√≠t√°s</option>
  </select>
  <button onclick="startGame()">J√°t√©k ind√≠t√°sa</button>
</div>

<h1>L√≥ri ≈∞rhaj√≥s J√°t√©ka</h1>
<p>Pontsz√°m: <span id="score">0</span></p>
<p>Legmagasabb pontsz√°m: <span id="highscore">0</span> (<span id="highscore-name">-</span>)</p>

<div id="active-powerups"></div>

<canvas id="gameCanvas"></canvas>

<div class="touch-zone touch-left" id="leftZone" style="display: none;"></div>
<div class="touch-zone touch-right" id="rightZone" style="display: none;"></div>

<div id="game-over">
  <p>Meghalt√°l!</p>
  <div id="leaderboard">
    <h3>Toplista</h3>
    <ul id="leaderboard-list"></ul>
  </div>
  <button id="restart-button" onclick="restartGame()">√öjraind√≠t√°s</button><br/>
  <button id="reset-leaderboard-button" onclick="resetLeaderboard()">Eredm√©nylista t√∂rl√©se</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth * 0.85;
  canvas.height = window.innerHeight * 0.55;

  let spaceship = { x: canvas.width / 2 - 20, y: canvas.height - 60, width: 40, height: 40 };
  let obstacles = [], powerups = [];
  let score = 0;
  let highscore = localStorage.getItem("highscore") || 0;
  let highscoreName = localStorage.getItem("highscoreName") || "-";
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  let isGameOver = false;
  let playerName = "";
  let controlMode = "touch";
  let moveLeft = false, moveRight = false;

  let activePowerups = [];

  const activePowerupsDisplay = document.getElementById("active-powerups");

  document.getElementById("score").innerText = score;
  document.getElementById("highscore").innerText = highscore;
  document.getElementById("highscore-name").innerText = highscoreName;

  function startGame() {
    const nameInput = document.getElementById("playerNameInput");
    const controlSelect = document.getElementById("controlMode");
    if (nameInput.value.trim() === "") return;
    playerName = nameInput.value.trim();
    controlMode = controlSelect.value;
    document.getElementById("name-input-screen").style.display = "none";

    if (controlMode === "touch") {
      document.getElementById("leftZone").style.display = "block";
      document.getElementById("rightZone").style.display = "block";
    }

    if (controlMode === "tilt") {
      if (typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function") {
        DeviceMotionEvent.requestPermission().then(response => {
          if (response === "granted") {
            window.addEventListener("deviceorientation", handleTilt);
          } else {
            alert("A d√∂nthet≈ë ir√°ny√≠t√°shoz enged√©ly sz√ºks√©ges!");
          }
        }).catch(console.error);
      } else {
        window.addEventListener("deviceorientation", handleTilt);
      }
    }

    updateLeaderboardDisplay();
    updateGame();
  }

  function drawSpaceship() {
    ctx.font = "25px Arial";
    ctx.fillText("üöÄ", spaceship.x, spaceship.y);
  }

  function drawObstacles() {
    ctx.font = "25px Arial";
    obstacles.forEach(o => ctx.fillText("üí•", o.x, o.y));
  }

  function drawPowerups() {
    ctx.font = "25px Arial";
    powerups.forEach(p => ctx.fillText(p.emoji, p.x, p.y));
  }

  function updateActivePowerupsDisplay() {
    activePowerupsDisplay.innerHTML = '';
    activePowerups.forEach(p => {
      const span = document.createElement("span");
      const remaining = Math.ceil((p.end - Date.now()) / 1000);
      span.textContent = `${p.emoji} ${remaining}s`;
      activePowerupsDisplay.appendChild(span);
    });
    activePowerups = activePowerups.filter(p => Date.now() < p.end);
  }

  function updateGame() {
    if (isGameOver) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawSpaceship();
    drawObstacles();
    drawPowerups();
    updateActivePowerupsDisplay();

    const isInvincible = activePowerups.some(p => p.type === "shield");
    const speedBoost = activePowerups.some(p => p.type === "boost");
    const obstacleSlowdown = activePowerups.some(p => p.type === "slow");

    const obstacleSpeed = obstacleSlowdown ? 1.5 : 3;
    obstacles.forEach(o => o.y += obstacleSpeed);
    powerups.forEach(p => p.y += 2);

    obstacles.forEach(o => {
      if (!isInvincible &&
          spaceship.x < o.x + 25 && spaceship.x + spaceship.width > o.x &&
          spaceship.y < o.y + 25 && spaceship.y + spaceship.height > o.y) {
        gameOver();
      }
    });

    powerups = powerups.filter(p => {
      const hit = spaceship.x < p.x + 25 && spaceship.x + spaceship.width > p.x &&
                  spaceship.y < p.y + 25 && spaceship.y + spaceship.height > p.y;
      if (hit) {
        if (p.type === "score") {
          score += 1;
        } else if (p.type === "extra") {
          score += 3;
        } else {
          activePowerups.push({ type: p.type, emoji: p.emoji, end: Date.now() + 5000 });
        }
        document.getElementById("score").innerText = score;
        if (score > highscore) {
          highscore = score;
          highscoreName = playerName;
          localStorage.setItem("highscore", highscore);
          localStorage.setItem("highscoreName", highscoreName);
          document.getElementById("highscore").innerText = highscore;
          document.getElementById("highscore-name").innerText = highscoreName;
        }
        return false;
      }
      return true;
    });

    obstacles = obstacles.filter(o => o.y < canvas.height);
    powerups = powerups.filter(p => p.y < canvas.height);

    requestAnimationFrame(updateGame);
  }

  function handleTilt(event) {
    const gamma = event.gamma;
    const speedBoost = activePowerups.some(p => p.type === "boost");
    let step = speedBoost ? 6 : 3;
    if (gamma > 5) spaceship.x += step;
    if (gamma < -5) spaceship.x -= step;
    spaceship.x = Math.max(0, Math.min(canvas.width - spaceship.width, spaceship.x));
  }

  document.getElementById("leftZone").addEventListener("touchstart", () => moveLeft = true);
  document.getElementById("leftZone").addEventListener("touchend", () => moveLeft = false);
  document.getElementById("rightZone").addEventListener("touchstart", () => moveRight = true);
  document.getElementById("rightZone").addEventListener("touchend", () => moveRight = false);

  function moveLoop() {
    if (!isGameOver && controlMode === "touch") {
      const speedBoost = activePowerups.some(p => p.type === "boost");
      let step = speedBoost ? 6 : 3;
      if (moveLeft) spaceship.x -= step;
      if (moveRight) spaceship.x += step;
      spaceship.x = Math.max(0, Math.min(canvas.width - spaceship.width, spaceship.x));
    }
    requestAnimationFrame(moveLoop);
  }
  moveLoop();

  function gameOver() {
    isGameOver = true;
    document.getElementById("game-over").style.display = "block";

    const existing = leaderboard.find(entry => entry.name === playerName);
    if (existing) {
      if (score > existing.score) {
        existing.score = score;
      }
    } else {
      leaderboard.push({ name: playerName, score });
    }

    leaderboard.sort((a, b) => b.score - a.score);
    leaderboard = leaderboard.slice(0, 5);
    localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
    updateLeaderboardDisplay();
  }

  function updateLeaderboardDisplay() {
    const list = document.getElementById("leaderboard-list");
    list.innerHTML = "";
    leaderboard.forEach(entry => {
      const li = document.createElement("li");
      li.innerText = `${entry.name}: ${entry.score} pont`;
      list.appendChild(li);
    });
  }

  function resetLeaderboard() {
    const pass = prompt("√çrd be a jelsz√≥t az eredm√©nylista √©s a highscore t√∂rl√©s√©hez:");
    if (pass === "reset") {
      leaderboard = [];
      localStorage.removeItem("leaderboard");
      localStorage.removeItem("highscore");
      localStorage.removeItem("highscoreName");
      document.getElementById("highscore").innerText = "0";
      document.getElementById("highscore-name").innerText = "-";
      updateLeaderboardDisplay();
      alert("Eredm√©nylista √©s highscore t√∂r√∂lve.");
    } else {
      alert("Hib√°s jelsz√≥!");
    }
  }

  function restartGame() {
    document.getElementById("game-over").style.display = "none";
    isGameOver = false;
    score = 0;
    activePowerups = [];
    document.getElementById("score").innerText = score;
    spaceship.x = canvas.width / 2 - 20;
    obstacles = [];
    powerups = [];
    updateGame();
  }

  function spawnObstacle() {
    obstacles.push({ x: Math.random() * (canvas.width - 30), y: 0 });
  }

  function spawnPowerup() {
    const types = [
      { type: "score", emoji: "‚≠ê" },
      { type: "extra", emoji: "üéÅ" },
      { type: "shield", emoji: "üõ°Ô∏è" },
      { type: "boost", emoji: "‚ö°" },
      { type: "slow", emoji: "üê¢" },
    ];
    const chosen = types[Math.floor(Math.random() * types.length)];
    powerups.push({ ...chosen, x: Math.random() * (canvas.width - 30), y: 0 });
  }

  setInterval(spawnObstacle, 800);
  setInterval(spawnPowerup, 2000);
</script>

</body>
</html>