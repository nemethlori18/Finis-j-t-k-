<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>≈∞rhaj√≥s J√°t√©k</title>
  <style>
    body {
      text-align: center;
      font-family: Arial, sans-serif;
      overflow: hidden;
      margin: 0;
    }
    canvas {
      background-color: gray;
      display: block;
      margin: auto;
      border: 2px solid black;
    }
    .joystick-container {
      position: fixed;
      bottom: 10px;
      width: 100px;
      height: 100px;
      background-color: lightgray;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      transform: translateX(-50%);
      z-index: 30;
    }
    .joystick {
      width: 40px;
      height: 40px;
      background-color: black;
      border-radius: 50%;
      position: absolute;
      transition: 0.05s;
    }
    #game-over {
      display: none;
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      font-size: 24px;
      border-radius: 10px;
      z-index: 20;
    }
    #restart-button, #reset-leaderboard-button {
      margin-top: 10px;
      padding: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    #name-input-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    #name-input-screen input {
      padding: 10px;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #name-input-screen button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
    #leaderboard {
      margin-top: 20px;
      color: white;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 10px;
    }
    #leaderboard h3 {
      margin: 5px;
    }
    #leaderboard ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>

<div id="name-input-screen">
  <h2>√çrd be a neved:</h2>
  <input type="text" id="playerNameInput" placeholder="N√©v">
  <button onclick="startGame()">J√°t√©k ind√≠t√°sa</button>
</div>

<h1>L√≥ri ≈∞rhaj√≥s J√°t√©ka</h1>
<p>Pontsz√°m: <span id="score">0</span></p>
<p>Legmagasabb pontsz√°m: <span id="highscore">0</span> (<span id="highscore-name">-</span>)</p>

<canvas id="gameCanvas"></canvas>

<div class="joystick-container" id="joystick-container">
  <div class="joystick" id="joystick"></div>
</div>

<div id="game-over">
  <p>Meghalt√°l! Mert egy csicska vagy.</p>
  <div id="leaderboard">
    <h3>Eredm√©nylista</h3>
    <ul id="leaderboard-list"></ul>
  </div>
  <button id="restart-button" onclick="restartGame()">√öjraind√≠t√°s</button><br/>
  <button id="reset-leaderboard-button" onclick="resetLeaderboard()">Eredm√©nylista t√∂rl√©se</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth * 0.85;
  canvas.height = window.innerHeight * 0.55;

  let spaceship = { x: canvas.width / 2 - 20, y: canvas.height - 60, width: 40, height: 40 };
  let obstacles = [], powerups = [];
  let score = 0;
  let highscore = localStorage.getItem("highscore") || 0;
  let highscoreName = localStorage.getItem("highscoreName") || "-";
  let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  let isGameOver = false;
  let playerName = "";

  document.getElementById("score").innerText = score;
  document.getElementById("highscore").innerText = highscore;
  document.getElementById("highscore-name").innerText = highscoreName;

  function startGame() {
    const nameInput = document.getElementById("playerNameInput");
    if (nameInput.value.trim() === "") return;
    playerName = nameInput.value.trim();
    document.getElementById("name-input-screen").style.display = "none";
    updateLeaderboardDisplay();
    updateGame();
  }

  function drawSpaceship() {
    ctx.font = "25px Arial";
    ctx.fillText("üöÄ", spaceship.x, spaceship.y);
  }

  function drawObstacles() {
    ctx.font = "25px Arial";
    obstacles.forEach(o => ctx.fillText("üí•", o.x, o.y));
  }

  function drawPowerups() {
    ctx.font = "25px Arial";
    powerups.forEach(p => ctx.fillText("‚≠ê", p.x, p.y));
  }

  function updateGame() {
    if (isGameOver) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawSpaceship();
    drawObstacles();
    drawPowerups();

    obstacles.forEach(o => o.y += 3);
    powerups.forEach(p => p.y += 2);

    obstacles.forEach(o => {
      if (spaceship.x < o.x + 20 && spaceship.x + spaceship.width > o.x &&
          spaceship.y < o.y + 20 && spaceship.y + spaceship.height > o.y) {
        gameOver();
      }
    });

    powerups = powerups.filter(p => {
      if (spaceship.x < p.x + 20 && spaceship.x + spaceship.width > p.x &&
          spaceship.y < p.y + 20 && spaceship.y + spaceship.height > p.y) {
        score += 1;
        document.getElementById("score").innerText = score;
        if (score > highscore) {
          highscore = score;
          highscoreName = playerName;
          localStorage.setItem("highscore", highscore);
          localStorage.setItem("highscoreName", highscoreName);
          document.getElementById("highscore").innerText = highscore;
          document.getElementById("highscore-name").innerText = highscoreName;
        }
        return false;
      }
      return true;
    });

    obstacles = obstacles.filter(o => o.y < canvas.height);
    powerups = powerups.filter(p => p.y < canvas.height);

    requestAnimationFrame(updateGame);
  }

  function gameOver() {
    isGameOver = true;
    document.getElementById("game-over").style.display = "block";
    leaderboard = leaderboard.filter(entry => entry.name !== playerName);
    leaderboard.push({ name: playerName, score });
    leaderboard.sort((a, b) => b.score - a.score);
    leaderboard = leaderboard.slice(0, 5);
    localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
    updateLeaderboardDisplay();
  }

  function updateLeaderboardDisplay() {
    const list = document.getElementById("leaderboard-list");
    list.innerHTML = "";
    leaderboard.forEach(entry => {
      const li = document.createElement("li");
      li.innerText = `${entry.name}: ${entry.score} pont`;
      list.appendChild(li);
    });
  }

  function resetLeaderboard() {
    const pass = prompt("√çrd be a jelsz√≥t az eredm√©nylista √©s a highscore t√∂rl√©s√©hez:");
    if (pass === "reset") {
      leaderboard = [];
      localStorage.removeItem("leaderboard");
      localStorage.removeItem("highscore");
      localStorage.removeItem("highscoreName");
      document.getElementById("highscore").innerText = "0";
      document.getElementById("highscore-name").innerText = "-";
      updateLeaderboardDisplay();
      alert("Eredm√©nylista √©s highscore t√∂r√∂lve.");
    } else {
      alert("Hib√°s jelsz√≥!");
    }
  }

  function restartGame() {
    document.getElementById("game-over").style.display = "none";
    isGameOver = false;
    score = 0;
    document.getElementById("score").innerText = score;
    spaceship.x = canvas.width / 2 - 20;
    obstacles = [];
    powerups = [];
    updateGame();
  }

  function spawnObstacle() {
    obstacles.push({ x: Math.random() * (canvas.width - 30), y: 0 });
  }

  function spawnPowerup() {
    powerups.push({ x: Math.random() * (canvas.width - 30), y: 0 });
  }

  setInterval(spawnObstacle, 800);
  setInterval(spawnPowerup, 1200);

  const joystick = document.getElementById("joystick");
  const joystickContainer = document.getElementById("joystick-container");

  let joystickCenterX = 0;

  window.addEventListener("touchstart", (event) => {
    if (event.target.closest("#joystick-container")) return;
    const touch = event.touches[0];
    joystickContainer.style.left = `${touch.clientX}px`;
    joystickContainer.style.bottom = "10px";
    joystickContainer.style.display = "flex";
    joystickCenterX = touch.clientX;
  });

  window.addEventListener("touchmove", (event) => {
    const touchX = event.touches[0].clientX;
    let deltaX = touchX - joystickCenterX;
    const maxDistance = 40;
    if (Math.abs(deltaX) > maxDistance) {
      deltaX = (deltaX / Math.abs(deltaX)) * maxDistance;
    }
    spaceship.x += deltaX * 0.1;
    spaceship.x = Math.max(0, Math.min(canvas.width - spaceship.width, spaceship.x));
    joystick.style.transform = `translate(${deltaX}px, 0px)`;
  });

  window.addEventListener("touchend", () => {
    joystick.style.transform = `translate(0px, 0px)`;
    joystickContainer.style.display = "none";
  });
</script>

</body>
</html>